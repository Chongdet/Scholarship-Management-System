{% extends "layouts/base.html" %}

{% block nav_links %}
    <a href="{{ url_for('officer.list_scholarships') }}" class="text-white hover:text-yellow-400 font-medium transition-colors">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏ô</a>
    <a href="{{ url_for('officer.applications') }}" class="text-white hover:text-yellow-400 font-medium transition-colors">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
    <a href="{{ url_for('officer.audit_log') }}" class="text-white hover:text-yellow-400 font-medium transition-colors">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</a>
{% endblock %}

{% block role_name %}‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-6">
    <div class="mb-4 flex items-center text-sm text-gray-500">
        <a href="{{ url_for('officer.applications') }}" class="hover:text-blue-600 transition">‡∏Å‡∏•‡∏±‡∏ö</a>
        <span class="mx-2">></span>
        <span class="font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</span>
    </div>

    <div class="mb-4 text-sm text-gray-700">
        ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ - {{ application.student_name }}
        <span class="text-gray-400">|</span>
        ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤: {{ application.student_id }}
    </div>

    <div class="border border-gray-300 bg-white">
        <form method="post" action="{{ url_for('officer.decide_application', application_id=application.id) }}" id="decisionForm">
        <div class="grid grid-cols-1 lg:grid-cols-3">
            <!-- Left Column: Summary -->
            <div class="p-6 border-b lg:border-b-0 lg:border-r border-gray-300">
                <div class="text-sm text-gray-600 mb-4 border border-blue-200 bg-blue-50 rounded-lg p-4">
                    <div class="font-semibold text-gray-800 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                    <div class="mt-1">
                        {% if application.status == 'pending' %}
                        ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        {% elif application.status == 'reviewing' %}
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                        {% elif application.status == 'needs_edit' %}
                        ‡∏£‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        {% elif application.status == 'interview' %}
                        ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå
                        {% elif application.status == 'approved' %}
                        ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                        {% elif application.status == 'needs_edit' %}
                        ‡∏£‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        {% endif %}
                    </div>
                    {% if application.status == 'reviewing' and application.reviewing_by %}
                    <div class="mt-2 text-xs text-gray-600">
                        ‡∏ú‡∏π‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: {{ application.reviewing_by }}
                    </div>
                    {% endif %}
                </div>

                <div class="text-sm text-gray-700 space-y-2 mb-4 border border-gray-200 bg-gray-50 rounded-lg p-4">
                    <div class="font-semibold text-gray-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
                    <div>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: {{ application.student_name }}</div>
                    <div>‡∏Ñ‡∏ì‡∏∞: {{ application.faculty }}</div>
                    <div>GPAX: {{ application.gpa }}</div>
                    <div>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: 081-234-5678</div>
                    <div>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: somchai.i@email.com</div>
                </div>

                <div class="text-sm text-gray-700 space-y-2 mb-4 border border-gray-200 bg-gray-50 rounded-lg p-4">
                    <div class="font-semibold text-gray-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
                    <div>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏∏‡∏ô: {{ application.scholarship.name }}</div>
                    <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£: {{ application.application_date }}</div>
                </div>

                <div class="text-sm text-gray-700 space-y-2 border border-gray-200 bg-gray-50 rounded-lg p-4">
                    <div class="font-semibold text-gray-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
                    <div>{{ application.notes or '‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏¢‡∏±‡∏ô‡∏´‡∏°‡∏±‡πà‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏£ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤‡∏†‡∏≤‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß' }}</div>
                </div>
            </div>

            <!-- Middle Column: Documents -->
            <div class="p-6 border-b lg:border-b-0 lg:border-r border-gray-300">
                <div class="font-semibold text-gray-800 mb-3">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (3)</div>
                <div class="space-y-3">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-3 hover:bg-blue-100 transition cursor-pointer doc-item" data-doc="transcript" data-doc-name="‡πÉ‡∏ö‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" onclick="viewDocument(this)">
                        <div class="flex-1 text-gray-800">üìÑ ‡πÉ‡∏ö‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                        <label class="flex items-center gap-2 text-sm text-gray-700" onclick="event.stopPropagation()">
                            <input type="checkbox" name="doc_transcript" required class="w-4 h-4 accent-blue-600">
                            <span class="doc-status" data-unchecked="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" data-checked="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                        </label>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-3 hover:bg-blue-100 transition cursor-pointer doc-item" data-doc="idcard" data-doc-name="‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô" onclick="viewDocument(this)">
                        <div class="flex-1 text-gray-800">ü™™ ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</div>
                        <label class="flex items-center gap-2 text-sm text-gray-700" onclick="event.stopPropagation()">
                            <input type="checkbox" name="doc_idcard" required class="w-4 h-4 accent-blue-600">
                            <span class="doc-status" data-unchecked="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" data-checked="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                        </label>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-3 hover:bg-blue-100 transition cursor-pointer doc-item" data-doc="house" data-doc-name="‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô" onclick="viewDocument(this)">
                        <div class="flex-1 text-gray-800">üè† ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô</div>
                        <label class="flex items-center gap-2 text-sm text-gray-700" onclick="event.stopPropagation()">
                            <input type="checkbox" name="doc_house" required class="w-4 h-4 accent-blue-600">
                            <span class="doc-status" data-unchecked="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" data-checked="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Right Column: Photo -->
            <div class="p-6">
                <div class="font-semibold text-gray-800 mb-3" id="imageTitle">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
                <div id="imageViewer" class="bg-gray-200 h-64 flex items-center justify-center text-gray-400 border border-gray-300 rounded-lg overflow-hidden">
                    <div class="text-center">
                        <div class="text-4xl mb-2">üëÜ</div>
                        <div>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
                    </div>
                </div>
            </div>
        </div>

        <input type="hidden" name="decision" id="decisionValue" value="">
        {% if application.status == 'interview' or application.status == 'approved' %}
        <div class="p-6 border-t border-gray-300 bg-blue-50">
            <div class="text-center py-4">
                <div class="text-blue-700 font-semibold text-lg mb-2">
                    {% if application.status == 'interview' %}
                    ‚úì ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå" ‡πÅ‡∏•‡πâ‡∏ß
                    {% elif application.status == 'approved' %}
                    ‚úì ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
                    {% endif %}
                </div>
                <div class="text-gray-600 text-sm">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ</div>
            </div>
        </div>
        {% else %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-6 border-t border-gray-300 bg-gray-50">
            <button type="button" id="openRejectModal" class="w-full text-center py-3 rounded-full bg-red-500 hover:bg-red-600 text-white font-medium transition shadow-sm hover:shadow-md">‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button type="button" id="openInterviewModal" class="w-full text-center py-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white font-medium transition shadow-sm hover:shadow-md">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</button>
        </div>
        {% endif %}

        <div id="rejectModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
            <div class="bg-white w-full max-w-2xl rounded-2xl shadow-lg p-6">
                <div class="text-lg font-semibold text-gray-800">‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</div>
                <div class="text-sm text-gray-600 mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á {{ application.student_name }}</div>

                <div class="mt-5">
                    <label class="text-sm font-medium text-gray-700">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç *</label>
                    <textarea name="reject_reason" rows="5" class="mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg" required></textarea>
                </div>

                <p class="text-xs text-gray-500 mt-4">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏£‡∏≤‡∏ö‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>

                <div class="mt-6 flex justify-between gap-3">
                    <button type="button" id="closeRejectModal" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" id="confirmRejectButton" class="px-4 py-2 rounded-full bg-gray-300 text-gray-800">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>
            </div>
        </div>

        <div id="interviewModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
            <div class="bg-white w-full max-w-xl rounded-2xl shadow-lg p-6">
                <div class="text-lg font-semibold text-gray-800">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</div>
                <div class="text-sm text-gray-600 mt-1">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö {{ application.student_name }}</div>

                <div class="mt-5 space-y-4">
                    <div>
                        <label class="text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</label>
                        <input type="date" name="interview_date" class="mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input type="time" name="interview_time" class="mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="text" name="interview_location" class="mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                </div>

                <p class="text-xs text-gray-500 mt-4">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‚Äù</p>

                <div class="mt-6 flex justify-between gap-3">
                    <button type="button" id="closeInterviewModal" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" id="confirmInterviewButton" class="px-4 py-2 rounded-full bg-gray-300 text-gray-800">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</button>
                </div>
            </div>
        </div>

        <div id="confirmModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
            <div class="bg-white w-full max-w-lg rounded-2xl shadow-lg p-6">
                <div class="text-lg font-semibold text-gray-800" id="confirmTitle">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                <div class="text-sm text-gray-600 mt-2" id="confirmMessage">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</div>

                <div class="mt-4 text-sm text-gray-600">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô <span id="confirmCountdown" class="font-semibold text-gray-800">10</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                </div>

                <div class="mt-6 flex justify-between gap-3">
                    <button type="button" id="cancelConfirmButton" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" id="submitConfirmButton" class="px-4 py-2 rounded-full bg-gray-300 text-gray-800 flex items-center gap-2">
                        <span class="confirm-text">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>
                        <span class="confirm-loading hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>
                    </button>
                </div>
            </div>
        </div>
        </form>
    </div>
</div>

<script>
    // Image viewer function
    const documentImages = {
        'transcript': 'https://via.placeholder.com/400x300/3B82F6/FFFFFF?text=‡πÉ‡∏ö‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
        'idcard': 'https://via.placeholder.com/400x300/10B981/FFFFFF?text=‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô',
        'house': 'https://via.placeholder.com/400x300/8B5CF6/FFFFFF?text=‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô'
    };

    function viewDocument(element) {
        const docType = element.dataset.doc;
        const docName = element.dataset.docName;
        const imageViewer = document.getElementById('imageViewer');
        const imageTitle = document.getElementById('imageTitle');
        
        // Remove active class from all documents
        document.querySelectorAll('.doc-item').forEach(item => {
            item.classList.remove('ring-2', 'ring-blue-500');
        });
        
        // Add active class to clicked document
        element.classList.add('ring-2', 'ring-blue-500');
        
        // Update title
        imageTitle.textContent = docName;
        
        // Update image
        imageViewer.innerHTML = `<img src="${documentImages[docType]}" alt="${docName}" class="w-full h-full object-contain">`;
    }

    const modal = document.getElementById('interviewModal');
    const openBtn = document.getElementById('openInterviewModal');
    const closeBtn = document.getElementById('closeInterviewModal');
    const rejectModal = document.getElementById('rejectModal');
    const openRejectBtn = document.getElementById('openRejectModal');
    const closeRejectBtn = document.getElementById('closeRejectModal');
    const confirmRejectButton = document.getElementById('confirmRejectButton');
    const confirmInterviewButton = document.getElementById('confirmInterviewButton');
    const decisionValue = document.getElementById('decisionValue');
    const confirmModal = document.getElementById('confirmModal');
    const confirmTitle = document.getElementById('confirmTitle');
    const confirmMessage = document.getElementById('confirmMessage');
    const confirmCountdown = document.getElementById('confirmCountdown');
    const cancelConfirmButton = document.getElementById('cancelConfirmButton');
    const submitConfirmButton = document.getElementById('submitConfirmButton');
    const confirmText = submitConfirmButton.querySelector('.confirm-text');
    const confirmLoading = submitConfirmButton.querySelector('.confirm-loading');
    const docInputs = Array.from(document.querySelectorAll('input[name^="doc_"]'));
    let confirmTimer = null;
    let remainingSeconds = 10;

    const updateDocLabels = () => {
        docInputs.forEach((input) => {
            const label = input.closest('label');
            const textEl = label ? label.querySelector('.doc-status') : null;
            if (!textEl) {
                return;
            }
            textEl.textContent = input.checked
                ? textEl.dataset.checked
                : textEl.dataset.unchecked;
        });
    };

    updateDocLabels();
    docInputs.forEach((input) => input.addEventListener('change', updateDocLabels));

    const canProceed = () => {
        const allChecked = docInputs.every((input) => input.checked);
        if (!allChecked) {
            const firstUnchecked = docInputs.find((input) => !input.checked);
            if (firstUnchecked) {
                firstUnchecked.reportValidity();
                firstUnchecked.focus();
            }
            return false;
        }
        return true;
    };

    const openConfirm = (titleText, messageText, decision) => {
        decisionValue.value = decision;
        confirmTitle.textContent = titleText;
        confirmMessage.textContent = messageText;
        remainingSeconds = 10;
        confirmCountdown.textContent = String(remainingSeconds);
        confirmText.classList.remove('hidden');
        confirmLoading.classList.add('hidden');
        submitConfirmButton.disabled = false;

        if (confirmTimer) {
            clearInterval(confirmTimer);
        }
        confirmTimer = setInterval(() => {
            remainingSeconds -= 1;
            confirmCountdown.textContent = String(remainingSeconds);
            if (remainingSeconds <= 0) {
                closeConfirm();
            }
        }, 1000);

        confirmModal.classList.remove('hidden');
        confirmModal.classList.add('flex');
    };

    const closeConfirm = () => {
        if (confirmTimer) {
            clearInterval(confirmTimer);
            confirmTimer = null;
        }
        confirmModal.classList.add('hidden');
        confirmModal.classList.remove('flex');
    };

    openBtn.addEventListener('click', () => {
        if (!canProceed()) {
            return;
        }
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    });

    openRejectBtn.addEventListener('click', () => {
        if (!canProceed()) {
            return;
        }
        rejectModal.classList.remove('hidden');
        rejectModal.classList.add('flex');
    });

    closeBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    });

    closeRejectBtn.addEventListener('click', () => {
        rejectModal.classList.add('hidden');
        rejectModal.classList.remove('flex');
    });

    confirmRejectButton.addEventListener('click', () => {
        const rejectReason = document.querySelector('textarea[name="reject_reason"]');
        if (rejectReason && !rejectReason.checkValidity()) {
            rejectReason.reportValidity();
            rejectReason.focus();
            return;
        }
        rejectModal.classList.add('hidden');
        rejectModal.classList.remove('flex');
        openConfirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', 'needs_edit');
    });

    confirmInterviewButton.addEventListener('click', () => {
        const dateInput = document.querySelector('input[name="interview_date"]');
        const timeInput = document.querySelector('input[name="interview_time"]');
        const locationInput = document.querySelector('input[name="interview_location"]');
        const inputs = [dateInput, timeInput, locationInput].filter(Boolean);
        const invalidInput = inputs.find((input) => !input.checkValidity());
        if (invalidInput) {
            invalidInput.reportValidity();
            invalidInput.focus();
            return;
        }
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        openConfirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', 'interview');
    });

    cancelConfirmButton.addEventListener('click', () => {
        closeConfirm();
    });

    submitConfirmButton.addEventListener('click', () => {
        submitConfirmButton.disabled = true;
        confirmText.classList.add('hidden');
        confirmLoading.classList.remove('hidden');
        document.getElementById('decisionForm').submit();
    });

    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    });

    rejectModal.addEventListener('click', (event) => {
        if (event.target === rejectModal) {
            rejectModal.classList.add('hidden');
            rejectModal.classList.remove('flex');
        }
    });

    confirmModal.addEventListener('click', (event) => {
        if (event.target === confirmModal) {
            closeConfirm();
        }
    });
</script>

{% endblock %}

